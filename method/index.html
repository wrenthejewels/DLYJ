<!DOCTYPE html>
<html lang='en'>

<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <link rel='preconnect' href='https://fonts.googleapis.com'>
    <link rel='preconnect' href='https://fonts.gstatic.com' crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=IBM+Plex+Mono:wght@400;500&family=Bebas+Neue&display=swap" rel="stylesheet">
    <script>
        // Prevent math flash of unstyled content; removed after MathJax finishes or on timeout
        (function () {
            const root = document.documentElement;
            root.classList.add('mathjax-pending');
            window.__mathjaxRevealTimeout = window.setTimeout(() => {
                root.classList.remove('mathjax-pending');
                root.classList.add('mathjax-ready');
            }, 2000);
        })();
    </script>
    <title>Methodology - Don't Lose Your Job</title>
    <style>
        :root {
            /* Warm neutral palette */
            --bg-page: #FFFFFF;
            --bg-card: #FFFFFF;
            --bg-subtle: #F7F7F7;
            --bg-hover: #F0EDE8;

            /* Text hierarchy */
            --text-primary: #1A1917;
            --text-secondary: #5C5850;
            --text-tertiary: #8A8578;

            /* Accent - blue to match page theme */
            --accent: #2a5298;
            --accent-hover: #1e3c72;
            --accent-subtle: rgba(42, 82, 152, 0.08);

            /* Borders */
            --border-light: #E8E4DE;
            --border-medium: #D9D4CC;

            /* Spacing scale */
            --space-1: 4px;
            --space-2: 8px;
            --space-3: 12px;
            --space-4: 16px;
            --space-5: 24px;
            --space-6: 32px;
            --space-7: 48px;
            --space-8: 64px;

            /* Typography scale */
            --text-xs: 0.75rem;
            --text-sm: 0.875rem;
            --text-base: 1rem;
            --text-lg: 1.125rem;
            --text-xl: 1.25rem;
            --text-2xl: 1.5rem;
            --text-3xl: 2rem;

            /* Radius */
            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 16px;
            --radius-full: 9999px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Prevent horizontal overflow on mobile */
        html, body {
            overflow-x: hidden;
            max-width: 100vw;
        }

        html {
            scroll-behavior: smooth;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-page);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        a {
            color: var(--accent);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s ease;
        }

        a:hover {
            color: var(--accent-hover);
            text-decoration: underline;
        }

        .container {
            width: 92.5%;
            max-width: none;
            margin: 0 auto;
            padding: 0 0 120px;
            background: transparent;
        }

        .article-body {
            transition: opacity 0.18s ease-in;
        }

        html.mathjax-pending .article-body,
        html.mathjax-rendering .article-body {
            opacity: 0;
        }

        html.mathjax-ready .article-body {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .container {
                width: 96%;
                padding: 0 0 80px;
            }
        }

        @media (max-width: 480px) {
            .container {
                width: 98%;
                padding: 0 0 60px;
            }
        }

        .content-wrapper {
            width: 100%;
            margin: 0 auto;
        }

        .site-header, .header {
            position: static;
            background: var(--bg-page);
            border-bottom: 1px solid var(--border-light);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);
            z-index: 100;
        }

        .centered-header {
            border-bottom: 1px solid var(--border-light);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);
            padding: 0;
        }

        .centered-header .header-inner {
            flex-direction: row;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
            text-align: left;
        }

        .header-inner {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--space-4) var(--space-5);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--space-5);
        }

        .brand, .header-brand {
            display: flex;
            align-items: center;
            gap: 6px;
            flex-direction: row;
        }

        .centered-brand,
        .centered-header .header-brand {
            align-items: center;
            flex: 1;
        }

        .brand-name, .publication-title {
            font-size: var(--text-sm);
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: -0.01em;
            line-height: 1;
            padding: var(--space-3) 0;
            display: inline-flex;
            flex-direction: row;
            gap: 0.35ch;
            white-space: nowrap;
        }

        .publication-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.75rem;
            letter-spacing: 0.05em;
            font-weight: 400;
            text-transform: uppercase;
            color: #1A1917;
        }

        .publication-title span {
            display: inline;
        }

        .author-name-header {
            font-family: 'Inter', sans-serif;
            font-size: 0.875rem;
            letter-spacing: 0.01em;
            text-transform: none;
            font-style: italic;
            color: #8A8578;
            font-weight: 400;
        }

        .nav {
            display: flex;
            gap: var(--space-2);
        }

        .centered-header .nav {
            margin-left: auto;
        }
        .nav-link {
            padding: 14px 30px;
            font-size: 1.05rem;
            font-weight: 500;
            color: var(--text-secondary);
            border-radius: var(--radius-full);
            transition: all 0.15s ease;
            text-decoration: none;
        }

        .nav-link:hover {
            color: var(--text-primary);
            background: var(--bg-subtle);
        }

        .nav-link.active {
            color: var(--text-primary);
            background: var(--bg-card);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            text-decoration: underline;
        }

        /* Sticky progress rail (desktop only) -- LessWrong-inspired */
        .progress-nav {
            --progress-fill: 0%;
            position: fixed;
            top: 150px;
            left: 24px;
            width: 240px;
            max-height: 86vh;
            padding: 10px 14px 12px 16px;
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 14px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            backdrop-filter: blur(8px);
            overflow-y: auto;
            overflow-x: hidden;
            font-size: 0.9rem;
            display: none;
            z-index: 120;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        @media (min-width: 1100px) {
            .progress-nav {
                display: block;
            }
        }

        .progress-nav h4 {
            margin: 0 0 12px;
            font-size: 0.82rem;
            color: #4b5563;
            letter-spacing: 0.06em;
            text-transform: uppercase;
        }

        .progress-nav ul {
            position: relative;
            list-style: none;
            padding: 6px 0 6px 18px;
            margin: 0;
        }

        .progress-nav ul::before {
            content: "";
            position: absolute;
            left: 6px;
            top: 8px;
            bottom: 8px;
            width: 2px;
            background: rgba(26, 25, 23, 0.2);
            border-radius: 999px;
        }

        .progress-nav ul::after {
            content: "";
            position: absolute;
            left: 6px;
            top: 8px;
            width: 2px;
            height: var(--progress-fill, 0%);
            background: #1A1917;
            border-radius: 999px;
            transition: height 0.18s ease;
        }

        .progress-nav li {
            position: relative;
            margin: 0 0 8px;
            padding-left: 2px;
        }

        .progress-nav li.depth-2 {
            margin-top: 12px;
        }

        .progress-nav li:last-child {
            margin-bottom: 0;
        }

        .progress-nav a {
            position: relative;
            color: #4b5563;
            text-decoration: none;
            display: block;
            padding: 8px 10px 8px 14px;
            border-radius: 10px;
            transition: color 0.15s ease, background 0.15s ease, border-color 0.15s ease;
            line-height: 1.3;
        }

        .progress-nav a.depth-2 {
            font-size: 0.95rem;
            font-weight: 700;
            color: #111827;
            background: rgba(26, 25, 23, 0.03);
            border: 1px solid transparent;
            padding-left: 16px;
        }

        .progress-nav a:hover {
            color: #1f2937;
            background: rgba(42, 82, 152, 0.06);
        }

        .progress-nav a.active {
            color: #1f2937;
            background: rgba(42, 82, 152, 0.12);
            font-weight: 700;
            border-color: rgba(42, 82, 152, 0.18);
        }

        .progress-nav::-webkit-scrollbar {
            display: none;
        }

        .progress-nav li.depth-3 {
            margin: 6px 0 6px 14px;
            padding-left: 12px;
            border-left: 2px solid #e5e7eb;
        }

        .progress-nav a.depth-3 {
            padding-left: 12px;
            font-size: 0.86rem;
            color: #4b5563;
            font-weight: 500;
        }

        .progress-nav li.depth-3.active {
            border-left-color: rgba(42, 82, 152, 0.35);
        }

        .guide-article {
            width: 100%;
        }

        .hero, .hero-section {
            text-align: center;
            padding: var(--space-8) 0 var(--space-7);
            max-width: 720px;
            margin: 0 auto;
            background: transparent;
            border-bottom: none;
        }

        .hero h1, .hero-section h1 {
            font-family: 'Inter', sans-serif;
            font-size: clamp(var(--text-3xl), 5vw, 3.5rem);
            font-weight: 600;
            line-height: 1.25;
            letter-spacing: -0.02em;
            color: var(--text-primary);
            margin-bottom: var(--space-4);
        }

        .hero p, .hero-section p {
            font-size: 1rem;
            color: var(--text-secondary);
            max-width: 540px;
            margin: 6px auto 0;
            line-height: 1.55;
        }

        .article-hero {
            text-align: center;
            padding: 62px 0 32px;
            max-width: 720px;
            margin: 0 auto 48px;
            background: transparent;
            border-bottom: 1px solid var(--border-light);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.03);
        }

        .article-hero h1 {
            font-family: 'Inter', sans-serif;
            font-size: clamp(1.9rem, 3vw, 2.6rem);
            letter-spacing: -0.015em;
            font-weight: 600;
            margin-top: 18px;
        }

        .lede, .article-hero p {
            font-size: 1rem;
            color: var(--text-secondary);
            max-width: 540px;
            margin: 6px auto 0;
            line-height: 1.55;
        }

        .meta-line {
            display: flex;
            gap: 16px;
            align-items: center;
            justify-content: center;
            margin-top: 24px;
            font-size: 0.85rem;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            color: #8c857d;
        }

        .article-body {
            width: min(1300px, 98%);
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 36px;
            padding-bottom: 120px;
        }

        .metr-intro {
            display: flex;
            flex-direction: column;
            gap: 32px;
        }

        .metr-brand-card {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 18px;
            padding: 28px;
            margin-bottom: 48px;
            box-shadow: 0 24px 60px rgba(15, 23, 42, 0.06);
            width: 100%;
        }

        .metr-brand-link {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
        }

        .metr-brand-link img {
            width: 56px;
            height: auto;
        }

        .metr-brand-text {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .metr-brand-title {
            font-family: 'Inter', sans-serif;
            font-size: 1.15rem;
            letter-spacing: 0.1em;
            color: #1f1c18;
            text-transform: uppercase;
        }

        .metr-brand-subtitle {
            font-size: 0.95rem;
            color: #5c564f;
        }

        .metr-figure {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 18px;
            padding: 20px;
            box-shadow: 0 24px 60px rgba(15, 23, 42, 0.05);
            width: 100%;
        }

        .metr-figure img {
            width: 100%;
            height: auto;
            border-radius: 12px;
        }

        .metr-figure figcaption {
            margin-top: 12px;
            font-size: 0.9rem;
            color: #6b635a;
        }

        .chart-note {
            margin-top: 18px;
            font-size: 0.92rem;
            color: #5c564f;
        }

        .article-body section {
            background: transparent;
            border: none;
            border-radius: 0;
            padding: 32px 36px;
            box-shadow: none;
        }

        .article-body h2 {
            font-family: 'Inter', sans-serif;
            font-size: 1.8rem;
            margin-bottom: 24px;
            color: var(--text-primary);
        }

        .article-body h3 {
            font-family: 'Inter', sans-serif;
            font-size: 1.2rem;
            margin: 32px 0 16px;
            color: var(--text-primary);
        }

        .article-body h3.h3-accent {
            color: #2a5298;
            margin: 26px 0 12px 0;
            font-size: 1.05em;
        }

        .article-body p {
            margin-bottom: 1.4em;
            color: var(--text-primary);
        }

        code {
            font-family: 'IBM Plex Mono', 'Menlo', monospace;
            font-size: 0.95rem;
            background: #f5efe4;
            color: var(--text-primary);
            padding: 0 4px;
            border-radius: 4px;
        }

        blockquote {
            border-left: 4px solid var(--text-primary);
            padding-left: 20px;
            margin: 24px 0;
            color: #5c564f;
            font-style: italic;
        }

        .equation-callout {
            margin: 28px 0;
            padding: 24px 28px;
            border: none;
            border-left: 4px solid var(--text-primary);
            background: #ffffff;
            border-radius: 14px;
            box-shadow: 0 10px 26px rgba(0, 0, 0, 0.06);
        }

        .callout-label {
            display: block;
            font-size: 0.8rem;
            letter-spacing: 0.12em;
            color: var(--text-secondary);
            text-transform: uppercase;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .equation-display {
            font-size: 1.1rem;
            color: var(--text-primary);
            overflow-x: auto;
            padding: 8px 0;
        }

        .detail-list {
            list-style: none;
            padding: 0;
            margin: 24px 0;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .detail-list li {
            background: transparent;
            border: none;
            border-left: 3px solid var(--text-primary);
            border-radius: 12px;
            padding: 16px 20px;
            color: var(--text-primary);
            box-shadow: 0 6px 14px rgba(0, 0, 0, 0.03);
        }

        .detail-list li strong {
            display: inline;
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            margin: 0;
            margin-right: 6px;
        }

        .insight-callout {
            border: none;
            border-left: 4px solid var(--text-primary);
            background: #ffffff;
            border-radius: 14px;
            padding: 20px 24px;
            margin: 28px 0;
            color: var(--text-primary);
            font-size: 0.95rem;
            box-shadow: 0 12px 28px rgba(0, 0, 0, 0.06);
        }

        .insight-callout strong {
            font-family: 'Inter', sans-serif;
        }

        .insight-callout h4 {
            margin: 0 0 12px 0;
            font-size: 1.05rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .insight-callout p {
            margin-bottom: 0.8em;
        }

        .insight-callout p:last-child {
            margin-bottom: 0;
        }

        .insight-callout ul {
            margin: 0 0 0 20px;
            padding: 0;
        }

        .insight-callout ul li {
            margin-bottom: 8px;
        }

        .insight-callout ul li:last-child {
            margin-bottom: 0;
        }

        /* Parameter table component for data tables */
        .parameter-table {
            margin: 24px 0;
            padding: 20px;
            background: #ffffff;
            border: 1px solid var(--border-light);
            border-radius: 14px;
            overflow-x: auto;
        }

        .parameter-table table {
            margin: 0 auto;
            border-collapse: collapse;
            font-family: 'IBM Plex Mono', monospace;
            width: 100%;
            font-size: 0.9rem;
        }

        .parameter-table th,
        .parameter-table td {
            padding: 8px 12px;
            text-align: left;
        }

        .parameter-table th {
            background: var(--bg-page);
            font-weight: 600;
            color: var(--text-primary);
            border-bottom: 1px solid var(--border-light);
        }

        .parameter-table td {
            border-bottom: 1px solid var(--border-light);
        }

        .parameter-table tr:last-child td {
            border-bottom: none;
        }

        .parameter-table .table-label {
            margin: 0 0 12px 0;
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--text-secondary);
        }

        /* Compact bubble table for defaults */
        .bubble-table {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
            gap: 16px;
            margin: 16px 0 24px;
        }

        @media (max-width: 480px) {
            .bubble-table {
                grid-template-columns: 1fr;
            }
        }
        .bubble-item {
            background: #ffffff;
            border: 1px solid var(--border-light);
            border-radius: 14px;
            padding: 14px 16px;
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 12px;
            overflow: visible;
        }
        .bubble-key {
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            color: var(--text-primary);
            flex: 1 1 auto;
            font-size: 0.85rem;
            white-space: normal;
            overflow: visible;
            min-width: 0;
            line-height: 1.3;
        }
        .bubble-val {
            color: var(--text-secondary);
            text-align: right;
            flex-shrink: 0;
            font-size: 0.84rem;
            white-space: normal;
            max-width: 180px;
            line-height: 1.3;
        }

        ol.action-list {
            counter-reset: step;
            list-style: none;
            padding: 0;
            margin: 24px 0;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        ol.action-list li {
            counter-increment: step;
            position: relative;
            padding: 18px 20px 18px 54px;
            background: transparent;
            border: none;
            border-radius: 0;
            color: var(--text-primary);
        }

        ol.action-list li::before {
            content: counter(step);
            position: absolute;
            left: 18px;
            top: 18px;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: #1f1c18;
            color: #ffffff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            font-weight: 600;
        }

        @media (max-width: 900px) {
            .header-inner {
                width: 94%;
            }

            .article-body section {
                padding: 32px;
            }
        }

        @media (max-width: 640px) {
            .header-inner {
                flex-direction: column;
                align-items: center;
                gap: 16px;
                padding: 12px 16px;
                text-align: center;
                width: 100%;
                max-width: 100%;
            }

            .centered-header .header-brand {
                align-items: center;
                justify-content: center;
                width: 100%;
                flex: none;
            }

            .centered-header .nav {
                margin-left: 0;
                justify-content: center;
                width: 100%;
            }

            .nav {
                flex-wrap: wrap;
                justify-content: center;
                gap: 8px;
            }

            .nav-link {
                padding: 8px 12px;
                font-size: 0.85rem;
            }

            .centered-header .header-inner {
                flex-direction: column;
                align-items: center;
                gap: 12px;
                padding: 12px 16px;
            }

            .publication-title {
                font-size: 1.4rem;
            }

            .hero-section {
                padding: 56px 16px 36px;
            }

            .article-hero {
                padding: 56px 16px 32px;
            }

            .article-hero h1 {
                font-size: clamp(1.8rem, 6vw, 2.4rem);
                margin-top: 12px;
                letter-spacing: -0.01em;
            }

            .hero-section h1 {
                font-size: clamp(1.6rem, 6vw, 2.2rem);
                letter-spacing: -0.01em;
            }

            .lede {
                font-size: 0.95rem;
                max-width: 100%;
                line-height: 1.6;
            }

            .article-body section {
                padding: 20px 16px;
                border-radius: 16px;
            }

            .article-body h2 {
                font-size: 1.4rem;
                margin-bottom: 16px;
            }

            .article-body h3 {
                font-size: 1.05rem;
            }

            .article-body p {
                font-size: 0.95rem;
            }

            .detail-list li {
                padding: 12px 14px;
                font-size: 0.9rem;
            }

            .equation-callout {
                padding: 16px 14px;
                border-radius: 12px;
            }

            .equation-display {
                font-size: 0.95rem;
                overflow-x: auto;
            }

            #model-flow-diagram {
                min-width: 550px;
            }

            .bubble-table {
                grid-template-columns: 1fr;
            }

            .bubble-item {
                padding: 12px 14px;
                gap: 8px;
                flex-wrap: wrap;
                align-items: flex-start;
            }

            .bubble-key {
                font-size: 0.80rem;
                flex: 1 1 100%;
                text-align: left;
                overflow: visible;
                white-space: normal;
            }

            .bubble-val {
                font-size: 0.79rem;
                flex: 1 1 100%;
                text-align: left;
                padding-left: 8px;
                color: #5c564f;
            }

            ol.action-list li {
                padding: 16px 18px 16px 48px;
            }

            ol.action-list li::before {
                left: 14px;
                top: 16px;
            }
        }

        @media (max-width: 380px) {
            .container {
                width: 100%;
            }

            .article-hero {
                padding: 56px 16px 32px;
            }

            .article-hero h1 {
                font-size: 1.5rem;
            }

            .article-body section {
                padding: 16px 12px;
                border-radius: 12px;
            }

            .nav-link {
                padding: 8px 12px;
                font-size: 0.85rem;
            }

            .metr-brand-card {
                padding: 16px;
            }

            .metr-figure {
                padding: 12px;
            }
        }
    </style>
</head>

<body>
    <nav class="progress-nav" aria-label="On this page">
        <ul id="progress-list" class="progress-rail"></ul>
    </nav>
    <header class="site-header centered-header">
        <div class="header-inner">
            <div class="header-brand centered-brand">
                <a href="/" style="text-decoration: none; color: inherit; cursor: pointer;">
                    <span class="publication-title">Don't Lose Your Job
                </a>
            </div>
            <nav class="nav">
                <a href="/" class="nav-link">Model</a>
                <a href="/guide" class="nav-link">Guide</a>
                <a href="/method" class="nav-link active">Methodology</a>
            </nav>
        </div>
    </header>

    <main class='container'>
        <div class='content-wrapper'>
            <article class='guide-article'>
                <header class='article-hero'>
                    <h1>Methodology</h1>
                    <p class='lede'>Technical breakdown of the hazard model, mathematical framework, and advanced model tuning.</p>
                </header>

                <div class='article-body'>

                    
                    <section>
                        <h2>Mathematical framework</h2>

                        <p>METR benchmarks measure AI capability growth and underpin the model's task horizon estimates. The calculator loads the latest METR dataset, identifies the current SOTA model (e.g., GPT-5.1-Codex-Max, November 2025), and derives doubling time via linear regression across SOTA points (typically ~6-7 months). Reliability penalties shrink the usable horizon: at 95% reliability, a ~162-minute median horizon becomes ~4.8 minutes (33x shorter), or ~235x shorter at 99% reliability. See the <a href="/guide#understanding-ai-capabilities">Guide</a> for background.</p>

                        <p>Jobs are decomposed into five task duration buckets: [5, 30, 120, 360, 720] minutes. The hazard channel opens when AI can reliably complete enough of these categories based on your task weights.</p>

                        <p>METR data provides the starting task length, reliability penalty, and doubling time. Your questionnaire answers set domain friction and contribute to the industry slider, which together shrink the effective horizon that feeds the task gates. All coefficients can be tweaked in the Model Tuning section.</p>

                        <div class='equation-callout'>
                            <span class='callout-label'>Survival relationship</span>
                            <div class='equation-display'>$$P_{\text{loss}}(t) = 1 - \exp\left(-\int_0^t \lambda_{\text{total}}(s)\, ds\right)$$</div>
                            <span class='callout-label'>Stacked hazard model</span>
                            <div class='equation-display'>$$\lambda_{\text{total}}(s) = \lambda_{\text{AI}}(s) + \lambda_{\text{macro}}(s) + \lambda_{\text{firm}}(s) + \lambda_{\text{role}}(s) + \lambda_{\text{personal}}(s)$$</div>
                        </div>

                        <h3>Model Flow: How Your Inputs Become Predictions</h3>

                        <div style="margin: 24px 0; padding: 20px; background: #ffffff; border-radius: 12px; border: 1px solid #e5e7eb; overflow-x: auto;">
                            <svg id="model-flow-diagram" viewBox="0 0 1000 800" style="width: 100%; min-width: 600px; height: auto; margin: 0 auto; display: block;">
                                <!-- Define styles -->
                                <defs>
                                    <style>
                                        .flow-box { transition: all 0.3s ease; cursor: pointer; }
                                        .flow-box:hover rect { fill: #ffffff; stroke: #1a1917; stroke-width: 2.5; }
                                        .flow-arrow { transition: all 0.3s ease; }
                                        .input-box rect { fill: #ffffff; stroke: #d9d4cc; }
                                        .calc-box rect { fill: #ffffff; stroke: #d9d4cc; }
                                        .output-box rect { fill: #f0f7f4; stroke: #7fa89b; }
                                        .blue-output rect { fill: #e8f1f8; stroke: #5a8db8; }
                                        .green-output rect { fill: #e8f5ee; stroke: #6ba583; }
                                    </style>
                                </defs>

                                <!-- Title -->
                                <text x="500" y="40" text-anchor="middle" font-family="'Inter', sans-serif" font-size="24" font-weight="600" fill="#495057">Your Inputs → Calculations → Results</text>

                                <!-- LEVEL 1: INPUTS -->
                                <g class="flow-box input-box" data-connects="task-dist,auto-timing,comp-timing">
                                    <rect x="50" y="90" width="280" height="120" rx="8" stroke-width="1.5"/>
                                    <text x="190" y="120" text-anchor="middle" font-family="'Inter', sans-serif" font-size="17" font-weight="600" fill="#1a1917">Questionnaire</text>
                                    <text x="190" y="143" text-anchor="middle" font-size="13" fill="#495057">Your answers to Q1-Q19</text>
                                    <text x="190" y="163" text-anchor="middle" font-size="11" fill="#868e96">AI capability, task characteristics,</text>
                                    <text x="190" y="178" text-anchor="middle" font-size="11" fill="#868e96">friction factors, and adaptability</text>
                                    <text x="190" y="193" text-anchor="middle" font-size="11" fill="#868e96">questions that shape all outputs</text>
                                </g>

                                <g class="flow-box input-box" data-connects="task-dist,comp-timing">
                                    <rect x="360" y="90" width="260" height="120" rx="8" stroke-width="1.5"/>
                                    <text x="490" y="120" text-anchor="middle" font-family="'Inter', sans-serif" font-size="17" font-weight="600" fill="#1a1917">Hierarchy Level</text>
                                    <text x="490" y="143" text-anchor="middle" font-size="13" fill="#495057">Level 1-5</text>
                                    <text x="490" y="163" text-anchor="middle" font-size="11" fill="#868e96">Position in organizational ladder.</text>
                                    <text x="490" y="178" text-anchor="middle" font-size="11" fill="#868e96">Affects compression vulnerability</text>
                                    <text x="490" y="193" text-anchor="middle" font-size="11" fill="#868e96">and task distribution patterns</text>
                                </g>

                                <g class="flow-box input-box" data-connects="auto-timing">
                                    <rect x="650" y="90" width="300" height="120" rx="8" stroke-width="1.5"/>
                                    <text x="800" y="120" text-anchor="middle" font-family="'Inter', sans-serif" font-size="17" font-weight="600" fill="#1a1917">Sliders</text>
                                    <text x="800" y="143" text-anchor="middle" font-size="13" fill="#495057">Reliability and Industry Friction</text>
                                    <text x="800" y="163" text-anchor="middle" font-size="11" fill="#868e96">Adjusts how strict automation needs</text>
                                    <text x="800" y="178" text-anchor="middle" font-size="11" fill="#868e96">to be (reliability) and how much harder</text>
                                    <text x="800" y="193" text-anchor="middle" font-size="11" fill="#868e96">your industry is to automate (friction)</text>
                                </g>

                                <!-- LEVEL 2: CALCULATIONS -->
                                <g id="task-dist" class="flow-box calc-box" data-connects="blue-output">
                                    <rect x="40" y="270" width="280" height="150" rx="8" stroke-width="1.5"/>
                                    <text x="180" y="300" text-anchor="middle" font-family="'Inter', sans-serif" font-size="16" font-weight="600" fill="#1a1917">Task Distribution</text>
                                    <text x="180" y="330" text-anchor="middle" font-size="12" fill="#495057">How your job splits across 5 task</text>
                                    <text x="180" y="348" text-anchor="middle" font-size="12" fill="#495057">duration buckets (short to long)</text>
                                    <text x="180" y="375" text-anchor="middle" font-size="11" fill="#868e96">Hierarchy level, Q5 (decomposability),</text>
                                    <text x="180" y="393" text-anchor="middle" font-size="11" fill="#868e96">Q6 (standardization), Q7 (context)</text>
                                    <text x="180" y="413" text-anchor="middle" font-size="10" font-style="italic" fill="#a88860">Can override manually in calculator</text>
                                </g>

                                <g id="auto-timing" class="flow-box calc-box" data-connects="blue-output,green-output">
                                    <rect x="360" y="270" width="280" height="150" rx="8" stroke-width="1.5"/>
                                    <text x="500" y="300" text-anchor="middle" font-family="'Inter', sans-serif" font-size="16" font-weight="600" fill="#1a1917">Automation Timing</text>
                                    <text x="500" y="330" text-anchor="middle" font-size="12" fill="#495057">When AI becomes technically capable</text>
                                    <text x="500" y="348" text-anchor="middle" font-size="12" fill="#495057">of doing your job (blue curve basis)</text>
                                    <text x="500" y="375" text-anchor="middle" font-size="11" fill="#868e96">Task buckets, reliability slider,</text>
                                    <text x="500" y="393" text-anchor="middle" font-size="11" fill="#868e96">industry friction, Q2/Q6-Q16</text>
                                </g>

                                <g id="comp-timing" class="flow-box calc-box" data-connects="green-output">
                                    <rect x="680" y="270" width="280" height="150" rx="8" stroke-width="1.5"/>
                                    <text x="820" y="300" text-anchor="middle" font-family="'Inter', sans-serif" font-size="16" font-weight="600" fill="#1a1917">Compression Risk</text>
                                    <text x="820" y="330" text-anchor="middle" font-size="12" fill="#495057">Job loss from task reallocation to</text>
                                    <text x="820" y="348" text-anchor="middle" font-size="12" fill="#495057">AI-amplified seniors (green modifier)</text>
                                    <text x="820" y="375" text-anchor="middle" font-size="11" fill="#868e96">Q10 (reallocation ease), Q4-Q9</text>
                                    <text x="820" y="393" text-anchor="middle" font-size="11" fill="#868e96">(AI learnability), hierarchy vulnerability</text>
                                </g>

                                <!-- LEVEL 3: OUTPUTS -->
                                <g id="blue-output" class="flow-box blue-output">
                                    <rect x="80" y="490" width="380" height="160" rx="8" stroke-width="1.5"/>
                                    <text x="270" y="520" text-anchor="middle" font-family="'Inter', sans-serif" font-size="16" font-weight="600" fill="#1a1917">Blue Curve</text>
                                    <text x="270" y="543" text-anchor="middle" font-size="13" fill="#495057">Timeline estimation of your role's</text>
                                    <text x="270" y="560" text-anchor="middle" font-size="13" fill="#495057">technical automation feasibility</text>
                                    <text x="270" y="583" text-anchor="middle" font-size="11" fill="#868e96">When AI becomes capable enough to</text>
                                    <text x="270" y="598" text-anchor="middle" font-size="11" fill="#868e96">perform your job, based on METR's task</text>
                                    <text x="270" y="613" text-anchor="middle" font-size="11" fill="#868e96">horizon data, your task distribution, and</text>
                                    <text x="270" y="628" text-anchor="middle" font-size="11" fill="#868e96">reliability/friction settings</text>
                                </g>

                                <g id="green-output" class="flow-box green-output">
                                    <rect x="540" y="490" width="380" height="160" rx="8" stroke-width="1.5"/>
                                    <text x="730" y="520" text-anchor="middle" font-family="'Inter', sans-serif" font-size="16" font-weight="600" fill="#6ba583">Green Curve</text>
                                    <text x="730" y="543" text-anchor="middle" font-size="13" fill="#495057">Timeline estimation of your</text>
                                    <text x="730" y="560" text-anchor="middle" font-size="13" fill="#495057">actual role elimination</text>
                                    <text x="730" y="583" text-anchor="middle" font-size="11" fill="#868e96">When job loss actually happens in practice.</text>
                                    <text x="730" y="598" text-anchor="middle" font-size="11" fill="#868e96">Combines blue curve + implementation</text>
                                    <text x="730" y="613" text-anchor="middle" font-size="11" fill="#868e96">delay + compression hazard. Can arrive</text>
                                    <text x="730" y="628" text-anchor="middle" font-size="11" fill="#868e96">earlier than blue if compression is high</text>
                                </g>

                                <!-- ARROWS: Inputs to Calculations -->
                                <path class="flow-arrow" d="M 190 210 L 180 270" stroke="#9b8b6f" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
                                <path class="flow-arrow" d="M 230 210 L 500 270" stroke="#9b8b6f" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
                                <path class="flow-arrow" d="M 260 210 L 820 270" stroke="#9b8b6f" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>

                                <path class="flow-arrow" d="M 490 210 L 220 270" stroke="#9b8b6f" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
                                <path class="flow-arrow" d="M 510 210 L 800 270" stroke="#9b8b6f" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>

                                <path class="flow-arrow" d="M 800 210 L 530 270" stroke="#9b8b6f" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>

                                <!-- ARROWS: Calculations to Outputs -->
                                <path class="flow-arrow" d="M 180 420 L 230 490" stroke="#9b8b6f" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
                                <path class="flow-arrow" d="M 500 420 L 320 490" stroke="#9b8b6f" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
                                <path class="flow-arrow" d="M 500 420 L 680 490" stroke="#9b8b6f" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
                                <path class="flow-arrow" d="M 820 420 L 770 490" stroke="#9b8b6f" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>

                                <!-- Arrow markers -->
                                <defs>
                                    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                                        <polygon points="0 0, 10 3, 0 6" fill="#9b8b6f"/>
                                    </marker>
                                </defs>

                                <!-- Legend -->
                                <g transform="translate(60, 690)">
                                    <text x="0" y="0" font-family="'Inter', sans-serif" font-size="12" font-weight="600" fill="#1a1917">Legend:</text>
                                    <rect x="0" y="12" width="20" height="20" rx="2" fill="#ffffff" stroke="#d9d4cc" stroke-width="1.5"/>
                                    <text x="26" y="26" font-size="11" fill="#495057">Your inputs</text>

                                    <rect x="140" y="12" width="20" height="20" rx="2" fill="#ffffff" stroke="#d9d4cc" stroke-width="1.5"/>
                                    <text x="166" y="26" font-size="11" fill="#495057">Calculations</text>

                                    <rect x="280" y="12" width="20" height="20" rx="2" fill="#e8f1f8" stroke="#5a8db8" stroke-width="1.5"/>
                                    <text x="306" y="26" font-size="11" fill="#495057">Blue curve</text>

                                    <rect x="410" y="12" width="20" height="20" rx="2" fill="#e8f5ee" stroke="#6ba583" stroke-width="1.5"/>
                                    <text x="436" y="26" font-size="11" fill="#495057">Green curve</text>

                                    <text x="560" y="26" font-size="11" fill="#868e96" font-style="italic">Hover over boxes to highlight connections</text>
                                </g>

                                <!-- Key insights -->
                                <g transform="translate(60, 760)">
                                </g>
                            </svg>
                        </div>

                        <script>
                            // Simple hover interactions for the model flow diagram
                            document.addEventListener('DOMContentLoaded', function() {
                                const flowBoxes = document.querySelectorAll('.flow-box');

                                flowBoxes.forEach(box => {
                                    box.addEventListener('mouseenter', function() {
                                        const connects = this.getAttribute('data-connects');
                                        if (connects) {
                                            connects.split(',').forEach(targetId => {
                                                const target = document.getElementById(targetId);
                                                if (target) {
                                                    target.querySelector('rect').style.fill = '#ffffff';
                                                    target.querySelector('rect').style.stroke = '#a88860';
                                                    target.querySelector('rect').style.strokeWidth = '2.5';
                                                }
                                            });
                                        }
                                    });

                                    box.addEventListener('mouseleave', function() {
                                        const connects = this.getAttribute('data-connects');
                                        if (connects) {
                                            connects.split(',').forEach(targetId => {
                                                const target = document.getElementById(targetId);
                                                if (target) {
                                                    // Reset to original colors based on box type
                                                    const rect = target.querySelector('rect');
                                                    if (target.classList.contains('calc-box')) {
                                                        rect.style.fill = '#ffffff';
                                                        rect.style.stroke = '#d9d4cc';
                                                    } else if (target.classList.contains('blue-output')) {
                                                        rect.style.fill = '#e8f1f8';
                                                        rect.style.stroke = '#5a8db8';
                                                    } else if (target.classList.contains('green-output')) {
                                                        rect.style.fill = '#e8f5ee';
                                                        rect.style.stroke = '#6ba583';
                                                    }
                                                    rect.style.strokeWidth = '1.5';
                                                }
                                            });
                                        }
                                    });
                                });
                            });
                        </script>

                        <h3 class="h3-accent">Model Defaults</h3>
                        <div class='bubble-table'>
                            <div class='bubble-item'><span class='bubble-key'>$H_{50,0}$</span><span class='bubble-val'>~162 min (GPT-5.1-Codex-Max SOTA)</span></div>
                            <div class='bubble-item'><span class='bubble-key'>$D$ (doubling, months)</span><span class='bubble-val'>~6-7 (computed from METR data)</span></div>
                            <div class='bubble-item'><span class='bubble-key'>$r$ (reliability)</span><span class='bubble-val'>0.95 (default)</span></div>
                            <div class='bubble-item'><span class='bubble-key'>$L_i$ (gate thresholds)</span><span class='bubble-val'>5, 30, 120, 360, 720 min</span></div>
                            <div class='bubble-item'><span class='bubble-key'>$w_i$ (weights)</span><span class='bubble-val'>15%, 30%, 30%, 15%, 10%</span></div>
                            <div class='bubble-item'><span class='bubble-key'>$s$ (softness)</span><span class='bubble-val'>0.35 (lower = sharper transition; range 0.20&ndash;0.55)</span></div>
                            <div class='bubble-item'><span class='bubble-key'>$h_{\text{AI}}$ (max hazard)</span><span class='bubble-val'>0.45/yr</span></div>
                            <div class='bubble-item'><span class='bubble-key'>$\gamma$ (steepness)</span><span class='bubble-val'>8.0</span></div>
                            <div class='bubble-item'><span class='bubble-key'>$\theta$ (threshold)</span><span class='bubble-val'>0.50</span></div>
                            <div class='bubble-item'><span class='bubble-key'>userMult range</span><span class='bubble-val'>0.33&times; to 3.0&times;</span></div>
                            <div class='bubble-item'><span class='bubble-key'>$t$ (timeline)</span><span class='bubble-val'>Years from now</span></div>
                            <div class='bubble-item'><span class='bubble-key'>$H_r(t)$</span><span class='bubble-val'>Task horizon at reliability $r$</span></div>
                            <div class='bubble-item'><span class='bubble-key'>$A_{\text{job}}$</span><span class='bubble-val'>Readiness &isin; [0,1]</span></div>
                            <div class='bubble-item'><span class='bubble-key'>$f(r)$</span><span class='bubble-val'>Reliability factor</span></div>
                            <div class='bubble-item'><span class='bubble-key'>Task buckets</span><span class='bubble-val'>&lt;10 min, 10-45 min, 45 min-3 hr, 3-8 hr, &gt;12 hr</span></div>
                            <div class='bubble-item'><span class='bubble-key'>Hazard floor</span><span class='bubble-val'>0.03/yr minimum risk</span></div>
                            <div class='bubble-item'><span class='bubble-key'>Hazard cap</span><span class='bubble-val'>0.95/yr ceiling after multipliers</span></div>
                            <div class='bubble-item'><span class='bubble-key'>Domain clamp</span><span class='bubble-val'>Penalty clamped to 0.8&ndash;1.6&times;</span></div>
                            <div class='bubble-item'><span class='bubble-key'>Compression: readiness mix</span><span class='bubble-val'>70% immediate / 30% amplified</span></div>
                            <div class='bubble-item'><span class='bubble-key'>Compression: cap gain</span><span class='bubble-val'>1.04 (scales with $A_{\text{job}}$)</span></div>
                            <div class='bubble-item'><span class='bubble-key'>Compression: floor</span><span class='bubble-val'>0.15 (min $A_{\text{job}}$ to activate)</span></div>
                            <div class='bubble-item'><span class='bubble-key'>Compression: amp</span><span class='bubble-val'>2.0 (max productivity boost)</span></div>
                            <div class='bubble-item'><span class='bubble-key'>Compression: gate</span><span class='bubble-val'>$\theta_c$=0.33, $\gamma_c$=6.0, $h_{\max,c}$=0.45/yr</span></div>
                        </div>

                        <h3 class="h3-accent">Friction Decay Parameter</h3>
                        <p>The model tracks how quickly organizational barriers weaken over time using a decay rate (&lambda;). This parameter is calculated from your questionnaire responses about company adoption readiness, infrastructure, labor market dynamics, and role characteristics:</p>
                        <div class='equation-callout'>
                            <span class='callout-label'>Friction decay rate</span>
                            <div class='equation-display'>$$\lambda = 0.02 + 0.01 \times (n_{12} - 0.5) + 0.01 \times (n_{15} - 0.5) + 0.005 \times (n_{13} - 0.5) + 0.005 \times (n_{14} - 0.5) - 0.01 \times (n_{11} - 0.5) - 0.01 \times (n_{10} - 0.5)$$</div>
                            <p style="font-size: 0.9em; margin-top: 8px; color: #666;">where $n_i$ is the normalized answer to question $i$ (Likert 1-5 scaled to 0-1), and $\lambda$ is clamped to $[0.005, 0.05]$</p>
                        </div>
                        <div class='bubble-table'>
                            <div class='bubble-item'><span class='bubble-key'>Q12 (Physical presence)</span><span class='bubble-val'>+0.01 weight</span></div>
                            <div class='bubble-item'><span class='bubble-key'>Q15 (Labor market tightness)</span><span class='bubble-val'>+0.01 weight</span></div>
                            <div class='bubble-item'><span class='bubble-key'>Q13 (Company AI adoption)</span><span class='bubble-val'>+0.005 weight</span></div>
                            <div class='bubble-item'><span class='bubble-key'>Q14 (Labor cost pressure)</span><span class='bubble-val'>+0.005 weight</span></div>
                            <div class='bubble-item'><span class='bubble-key'>Q11 (Human judgment)</span><span class='bubble-val'>-0.01 weight</span></div>
                            <div class='bubble-item'><span class='bubble-key'>Q10 (Task reallocation)</span><span class='bubble-val'>-0.01 weight</span></div>
                        </div>
                        <p>This parameter controls how quickly implementation barriers shrink as AI capability grows. The model implements dynamic friction decay where implementation delay decreases exponentially: $\Delta(t) = \Delta_0 \cdot e^{-\lambda t}$. At time $t$, the green curve (actual job loss) equals technical feasibility at the earlier time $t - \Delta(t)$. Higher $\lambda$ means barriers collapse faster once AI crosses initial thresholds, while lower $\lambda$ means barriers persist even as capability advances. This captures how regulatory frameworks and organizational inertia may initially delay adoption by several years, though these delays shrink as AI improves and more companies adopt it.</p>
                        <p>The decay accelerates once $\lambda$ exceeds 0.025 (the knee point). Two additional parameters shape the dynamics: a saturation boost (0.6) that amplifies decay as capability matures, and a capability gain factor (0.8) that links delay compression to job readiness growth. Together these determine how quickly barriers collapse once AI capability and organizational readiness combine.</p>

                        <h3 class="h3-accent">Role Presets</h3>
                        <p>Different roles face different automation barriers. Software engineering maps most directly to AI's training data and requires less physical presence, so it gets lower friction (1.05x). Legal work and traditional engineering involve more tacit knowledge, regulatory constraints, and liability concerns, earning higher friction multipliers (1.45–1.50x). These multipliers reflect how much harder it is to automate each domain compared to software.</p>
                        <p><strong>Two-layer friction system:</strong> Industry friction applies to all roles in a sector (e.g., finance ~1.35×), while your questionnaire adds role-specific friction from tacit knowledge, physical presence, and context. Both layers multiply together (friction presets widen the domain clamp, but capability doubling stays from METR).</p>
                        <ul class='detail-list'>
                            <li><strong>Domain friction (preset baseline):</strong> Role presets set an initial friction multiplier (software ~1.05x, admin/data ~1.10x, finance/consulting ~1.35x, legal ~1.45x, engineering ~1.50x) before individual job characteristics are considered.</li>
                            <li><strong>Recommended reliability:</strong> Presets suggest a reliability starting point per role based on typical error tolerance and stakes (finance/legal 97&ndash;98%, software/data 92&ndash;93%, creative/customer service 88&ndash;90%). Seniority adjusts these baselines: entry-level roles tolerate slightly lower reliability (&minus;0.05), while executive decisions demand higher confidence (+0.05). Higher reliability requirements significantly reduce effective task horizon. You can override both friction and reliability in the UI to test different scenarios.</li>
                        </ul>
                        <p>Beyond the preset baseline, the calculator derives a role-specific <em>domain alignment</em> penalty from your answers. Digitized, decomposable, and standardized work (Q4/Q5/Q6 high) reduces the penalty, while context dependence, tacit knowledge, judgment/relationship load, and physical presence (Q7/Q9/Q11/Q12 high) increase it. The model forms a signed weighted sum and maps it to a penalty multiplier via an exponential, clamped to a reasonable range. This penalty multiplies with the sector slider, so domain misalignment adds to friction.</p>
                        <div class='equation-callout'>
                            <span class='callout-label'>AI hazard core</span>
                            <div class='equation-display'>$$\lambda_{\text{AI}}(s) = \frac{h_{\max}}{1 + \exp\!\big(-\gamma (A_{\text{job}}(s) - \theta)\big)} \cdot M_{\text{user}}(s)$$</div>
                        </div>
                        <p>The hazard activates once AI capability crosses a coverage threshold. Two gates control this: task-level gates determine which individual tasks AI can handle, while a job-level gate opens when enough of your job is automatable to justify replacement. Here's the sequence:</p>
                        <ol class='action-list'>
                            <li><strong>Task-level gates open gradually:</strong> As AI capability $H_r(t)$ grows via METR's doubling trend, each task bucket's gate $G_i(H)$ opens. Short tasks automate first (gates open when $H$ exceeds their threshold $L_i$), then medium tasks, then long tasks. Your personalized weights $w_i$ determine how much each gate contributes to overall readiness.</li>
                            <li><strong>Job readiness accumulates:</strong> $A(t) = \sum w_i G_i(H)$ sums up all the open gates, weighted by your job profile. This gives a number between 0 and 1 representing what fraction of your job AI can perform.</li>
                            <li><strong>Job-level hazard gate activates:</strong> When $A(t)$ crosses the coverage threshold $\theta$ (typically 0.50), the hazard function $\lambda_{\text{AI}}(t)$ rapidly increases via the logistic gate. Before this point, hazard is near zero; after, it approaches the maximum $h_{\max} \times M_{\text{user}}$.</li>
                        </ol>
                        <div class='equation-callout'>
                            <span class='callout-label'>Task horizon</span>
                            <div class='equation-display'>$$H_r(t) = \frac{H_{50,0} \cdot 2^{(t \cdot 12)/D}}{p_{\text{domain}} \cdot f_{\text{industry}} \cdot f(r)}$$</div>
                            <p style="font-size: 0.9em; margin-top: 8px; color: #666;">where $p_{\text{domain}}$ = role-specific penalty from questionnaire, $f_{\text{industry}}$ = industry friction slider</p>
                        </div>
                        <p>The numerator's exponential term $2^{(t \cdot 12)/D}$ doubles roughly every 6–7 months per METR data—this is the capability growth. Domain friction, industry friction, and the reliability penalty are constant divisors that scale down this baseline; they don't affect the growth rate, only the starting point.</p>
                        <p>Reliability penalty: $\;f(r)=e^{-\sigma \cdot \text{logit}(r)}$ with $\sigma = \ln(H_{80}/H_{50}) / \ln(4)$. At 95% reliability, $f(r)\approx 33.4$, so the median 162-minute horizon becomes ~4.8 minutes of production-ready work.</p>
                        <p>Domain penalty: weighted Q4/5/6 (−) vs Q7/9/11/12 (+) → exponential penalty clamped (default 0.8–1.6×; widened by friction presets). Industry slider multiplies on top. Neutral answers include a modest baseline bias (~1.2×) before clamping to reflect average domain mismatch.</p>
                        <ul class='detail-list'>
                            <li><strong>Personalized task weights $w_i$:</strong> Your answers to Q5 (task decomposability), Q6 (task standardization), Q7 (context dependency), and your hierarchy level determine how your job breaks down across the five buckets. Entry-level roles skew toward shorter tasks; executive roles skew toward longer tasks. Highly structured jobs concentrate weight in the short buckets; complex jobs shift weight to longer buckets. High-context work means more weight in the 1&ndash;3 hr and &gt;12 hr buckets. The weights always sum to 1.0 and represent what fraction of your job falls into each duration category.</li>
                            <li><strong>Gate softness parameter $s$:</strong> Controls how sharply tasks transition from "AI can't do this" to "AI can do this". Entry-level structured work has sharper transitions; senior complex work has smoother, more gradual automation curves. Base value is 0.35, adjusted by seniority (&pm;0.03 per level) and task complexity (Q5, Q6). Range: [0.20, 0.55].</li>
                            <li><strong>Readiness $A_{\text{job}}(t)$:</strong> $$A_{\text{job}}(t) = \sum_i w_i G_i(H_r(t))$$ This weighted sum tells us what fraction of your job AI can perform at time $t$. If you're an entry-level role with 40% of tasks under 5 minutes and AI's capability $H_r(t)$ has reached 10 minutes, the &lt;5 min gate is fully open ($G_1 \approx 1.0$), contributing $0.40 \times 1.0 = 0.40$ to readiness. Jobs with more long-duration tasks need higher $H_r$ before their readiness $A(t)$ crosses the coverage threshold $\theta$, delaying automation.</li>
                            <li><strong>Coverage bar $\theta$:</strong> Baseline is 0.50, adjusted by seniority (thetaLift from -0.015 to +0.040), domain alignment (coefficient 0.09, ~&pm;0.09 at extremes), and role explicitness (coefficient 0.08, ~&pm;0.08 at extremes). Data-rich jobs, standardized workflows, and fast feedback loops lower this threshold; tacit, high-context, and senior roles push it higher. Clamped to [0.50, 0.82]. This threshold controls how much of the job must be automatable before displacement risk activates.</li>
                            <li><strong>User multipliers $M_{\text{user}}(s)$:</strong> Questionnaire responses exponentiate into amplifier and friction sums, then are capped between $0.33\times$ and $3\times$ for responsiveness.</li>
                        </ul>
                    </section>

                    <section>
                        <h2>How your answers move the curve</h2>
                        <p>Your answers (on a 1–5 Likert scale) are converted so that neutral (3) maps to 0, allowing symmetric effects above and below the midpoint. The model combines these into amplifier and friction scores, then converts them to multipliers ranging from 0.33&times; to 3.0&times;.</p>
                        <p>The prompts fall into four themes:</p>
                        <ul class='detail-list'>
                            <li><strong>AI readiness (Q1-Q4):</strong> High scores strengthen the amplifier channel when you indicate strong capability for AI learning and completing your tasks. Additionally, Q1 (current AI performance), Q2 (example work availability), Q3 (benchmark clarity), and Q4 (work digitization) all contribute to role explicitness ($s_e$), which lowers the coverage threshold $\theta$, making automation viable at lower overall capability levels.</li>
                            <li><strong>Task structure (Q5&ndash;Q9):</strong> These questions affect the blue curve (technical feasibility) through multiple mechanisms: <strong>(1)</strong> Q5, Q6 shift the task duration profile (structured &rarr; shorter buckets, complex &rarr; longer buckets), <strong>(2)</strong> Q2, Q5, Q6, Q8 contribute to $s_e$ which <strong>lowers $\theta$</strong> (data-rich, decomposable, standardized, fast-feedback jobs become viable at lower capability), and <strong>(3)</strong> Q7, Q9 increase the domain penalty $p_{\text{domain}}$ (high context, tacit knowledge damp capability). Together, these determine when your specific job crosses the automation threshold.</li>
                            <li><strong>Human moat (Q11-Q12):</strong> Relationship intensity and physical presence both load the friction side and stretch the METR baseline via the domain penalty, pushing the curve out.</li>
                            <li><strong>Firm and personal context (Q13-Q19):</strong> Company levers shape implementation delay. Job performance (Q19) delays displacement for top performers while also helping re-employment. Adaptability (Q18) and transferability (Q17) drive re-employment probability.</li>
                        </ul>
                        <p><strong>How role clarity affects the threshold:</strong> Questions Q1, Q2, Q3, Q4, Q5, Q6, and Q8 (positive factors) are averaged together, while Q7 and Q9 (context dependency and tacit knowledge, the protective factors) are averaged separately. The formula $s_e = 0.65 \times \text{norm}(s_{\text{pos}}) - 0.35 \times \text{norm}(s_{\text{neg}}) + 0.10$ produces a score between 0 and 1. Higher scores (more explicit roles) reduce $\theta$ via the shift $\Delta_{s_e} = 0.10 \times (0.5 - s_e)$, meaning AI needs less total job coverage before automation becomes economically viable.</p>

                        <p>The model also adjusts how sharply the hazard ramps up ($\gamma$) based on task characteristics. Structured work, fast feedback, and standardized tasks make the transition sudden; messy, collaborative, or custom work makes it gradual. This affects whether adoption happens quickly once the threshold is crossed or drags out over years.</p>
                    </section>

                    <section>
                        <h2>The green curve: Implementation delay and workforce compression</h2>

                        <p>The green curve (actual job loss) differs from the blue curve (technical feasibility) through two mechanisms: organizational adoption barriers that delay automation, and compression-driven workforce reductions that can cause job loss earlier.</p>

                        <h3>How the green curve is calculated</h3>

                        <p>The model integrates two separate hazard channels to create the green curve:</p>

                        <div class='equation-callout'>
                            <span class='callout-label'>Green curve total hazard</span>
                            <div class='equation-display'>$$\lambda_{\text{total}}(t) = \lambda_{\text{AI}}(t - \Delta(t)) + \lambda_{\text{compression}}(t)$$</div>
                            <span class='callout-label'>Where implementation delay decreases over time</span>
                            <div class='equation-display'>$$\Delta(t) = \Delta_0 \cdot e^{-\lambda t}$$</div>
                        </div>

                        <p>This structure captures two different ways jobs disappear:</p>

                        <ul class='detail-list'>
                            <li><strong>Delayed automation hazard:</strong> The AI automation hazard $\lambda_{\text{AI}}$ is evaluated at an earlier time $(t - \Delta(t))$ due to organizational friction. Early in the timeline, implementation barriers create a significant delay ($\Delta_0$), but this delay shrinks exponentially as AI capability grows and adoption accelerates. The friction decay rate $\lambda$ determines how fast these barriers collapse.</li>
                            <li><strong>Compression hazard:</strong> A separate hazard channel $\lambda_{\text{compression}}(t)$ that activates when AI makes senior workers productive enough to absorb junior work. This hazard is evaluated at the current time $t$ (no delay) and can cause job loss well before full automation becomes technically feasible. The two hazards are summed and capped at 0.60/year total.</li>
                        </ul>

                        <h3>Mechanism 1: Implementation delay (shifts automation hazard forward)</h3>

                        <p>Organizational barriers slow AI automation adoption. The initial delay $\Delta_0$ derives from company context (Q13-Q16: adoption appetite, labor cost pressure, market tightness, infrastructure) and individual leverage (Q19: job performance protects top performers). This delay ranges from 0.3 to 4.0 years depending on your situation.</p>

                        <div class='equation-callout'>
                            <span class='callout-label'>Initial delay calculation</span>
                            <div class='equation-display'>$$\Delta_0 = \operatorname{clip}\big(1.75 - 1.25\, s_{\text{delay}} + \Delta^{\text{eff}}_{\text{seniority}},\; 0.3,\; 4.0\big)$$</div>
                            <div class='equation-display'>$$\Delta^{\text{eff}}_{\text{seniority}} = \Delta_{\text{seniority}} \cdot \Big[1 + 0.5\, (\operatorname{norm}(Q19) - 0.5)\, \operatorname{sign}(\Delta_{\text{seniority}})\Big]$$</div>
                            <p style="font-size: 0.9em; margin-top: 8px; color: #666;">$s_{\text{delay}} \in [-2,2]$ from Q13-Q16; $\Delta_{\text{seniority}} \in \{-0.10,-0.03,+0.06,+0.10,+0.12\}$ years by level; result clamped to 0.3–4.0 years</p>
                        </div>

                        <p><strong>Dynamic friction decay:</strong> The delay doesn't stay constant. As AI capability increases and adoption spreads, organizational barriers shrink over time: $\Delta(t) = \Delta_0 \cdot e^{-\lambda t}$. The decay rate $\lambda$ (typically 0.02–0.05/year) is derived from your questionnaire answers (see <em>Friction Decay Parameter</em> above).</p>

                        <p><strong>Example delays:</strong> An early-adopting entry-level role starts with a 0.3-year delay. A defensive environment with senior leadership starts with a 4.0-year delay. Performance (Q19) adjusts these: high performers get extended delays; low performers face shortened timelines.</p>

                        <h3>Mechanism 2: Workforce compression (earlier job loss via task reallocation)</h3>

                        <p>Compression activates at 33% job coverage versus 50% for direct automation. For conceptual explanation, see the <a href="/guide">Guide</a>. Technical implementation:</p>

                        <div class='equation-callout'>
                            <span class='callout-label'>Compression hazard (base calculation)</span>
                            <div class='equation-display'>$$\lambda_{\text{compression}}(t) = \frac{h_{\max,c}}{1 + \exp(-\gamma_c (R_c(t) - \theta_c))} \cdot V_{\text{hierarchy}} \cdot G_{\text{readiness}}(t)$$</div>
                            <span class='callout-label'>Where compression readiness uses a hybrid formula with capability scaling:</span>
                            <div class='equation-display'>$$R_c(t) = s_{\text{realloc}} \times \big(0.7 + 0.3(1 + B_{\text{amp}})\big) \times \big(1 + 1.04 \cdot A_{\text{job}}(t)\big)$$</div>
                            <span class='callout-label'>And readiness gate prevents premature compression:</span>
                            <div class='equation-display'>$$G_{\text{readiness}}(t) = \max\Big(0,\, \min\Big(1,\, \frac{A_{\text{job}}(t) - 0.15}{1 - 0.15}\Big)\Big)$$</div>
                            <span class='callout-label'>Amplification boost is:</span>
                            <div class='equation-display'>$$B_{\text{amp}} = f_{\text{effective}} \cdot A_{\text{job}}(t) \cdot \text{norm}(Q1) \cdot 2.0$$</div>
                            <span class='callout-label'>Where effective digital fraction accounts for AI learnability:</span>
                            <div class='equation-display'>$$f_{\text{effective}} = \text{norm}(Q4) \times \max\big(0.1,\, 1 - 0.35\,\text{norm}(Q7) - 0.30\,\text{norm}(Q9) - 0.20\,(1{-}\text{norm}(Q5)) - 0.15\,(1{-}\text{norm}(Q6))\big)$$</div>
                        </div>

                        <p>The <strong>hybrid formula</strong> means compression readiness has two components: 70% comes from reallocation feasibility alone (immediate effect), and 30% grows over time as AI amplifies senior productivity. This ensures Q10 has a noticeable immediate impact while preserving the time-dependent behavior where compression risk accelerates as AI becomes more capable.</p>

                        <p>The <strong>capability scaling factor</strong> $(1 + 1.04 \cdot A_{\text{job}}(t))$ further amplifies compression readiness as AI capability grows. When AI can perform none of your job ($A_{\text{job}} = 0$), the factor is 1.0 (no scaling). When AI can perform your entire job ($A_{\text{job}} = 1$), the factor reaches 2.04, meaning compression readiness roughly doubles at full capability. This captures how organizational willingness to restructure accelerates as AI proves itself capable.</p>

                        <p>The <strong>readiness gate</strong> $G_{\text{readiness}}(t)$ ensures compression hazard remains at zero until AI reaches at least 15% job readiness ($A_{\text{job}} \geq 0.15$), then ramps linearly to full strength by 100% readiness. This prevents spurious compression risk predictions when AI capability is still minimal.</p>

                        <ol class='action-list'>
                            <li><strong>Reallocation feasibility ($s_{\text{realloc}}$):</strong> Combines Q10 (direct reallocation question: <strong>50% weight</strong>), task structure (Q5: 18%, Q6: 12%, Q7: 8% inverted), tacit knowledge (Q9: 10% inverted), and physical presence (Q12: 2% inverted). Q10 is the dominant factor since it directly measures how easily your responsibilities could be redistributed to existing team members. Higher scores mean your work can be easily absorbed by others. Range: [0, 1].</li>
                            <li><strong>Senior productivity amplification ($B_{\text{amp}}$):</strong> AI only amplifies productivity for work that is both digital and AI-learnable. Raw digitization (Q4) is discounted by factors that make digital work harder for AI to learn from: context dependency (Q7: 35% weight), tacit knowledge (Q9: 30% weight), low decomposability (Q5: 20% weight), and low standardization (Q6: 15% weight). A senior consultant whose deliverables are 100% digital but require extensive context, relationships, and tacit judgment gets minimal amplification because while the work is digital, AI cannot learn to replicate it by observing outputs. Conversely, highly digital, standardized, decomposable work with low context enables strong amplification. The boost ranges from 0 to 2.0 (up to +200% output, or 3&times; productivity when used in $(1 + B_{\text{amp}})$), scaled by current AI performance (Q1) and job readiness $A_{\text{job}}(t)$. This factor grows over time as AI capability increases.</li>
                            <li><strong>Hierarchy vulnerability ($V_{\text{hierarchy}}$):</strong> Your position in the workflow determines exposure. Calculated as $(6 - \text{level}) / 5$. Level 1 (many layers above) = 100% vulnerable. Level 4 = 40% vulnerable. Level 5 (top of domain, no one above can do your work) = 20% vulnerable. A principal engineer who owns a system faces minimal compression risk despite being in a "senior" role title.</li>
                        </ol>

                        <p><strong>Parameters differ from full automation:</strong> The compression gate opens at $\theta_c = 0.33$ (vs. $\theta \approx 0.50$ for automation), has gentler slope ($\gamma_c = 6.0$ vs. $\gamma = 8.0$), and equal maximum hazard ($h_{\max,c} = 0.45$/year, matching automation's $h_{\max} = 0.45$/year). For vulnerable positions, AI-driven workforce compression poses significant risk alongside direct automation—earlier onset but more gradual ramp-up. Combined with automation hazard, the total is capped at 0.60/year to reflect real-world institutional friction that prevents instant mass layoffs.</p>

                        <h3>Re-employment probability</h3>

                        <p>Re-employment starts at a 60% baseline and blends five forces:</p>
                        <ul class='detail-list'>
                            <li><strong>Adaptability core (Q17, Q18, Q19):</strong> Transferability, learning speed, and performance move odds up or down (0.2 per weighted point, clamped to avoid runaway extremes).</li>
                            <li><strong>Task structure (Q5, Q6, Q8):</strong> Highly decomposable, standardized, and feedback-rich tasks are easier to automate and harder to pivot from, reducing re-employment odds by up to ~12 percentage points at the defaults. More tacit, varied work with slower feedback loops protects re-employment prospects.</li>
                            <li><strong>Labor tightness (Q15):</strong> A modest multiplier (+/-5% at defaults) reflecting how forgiving the market is.</li>
                            <li><strong>Global AI saturation penalty:</strong> As global AI capability matures (measured by when the blue technical feasibility curve hits 50%), the total number of available jobs shrinks. This penalty affects everyone equally based on the global state of AI: $\text{penalty}_{\text{global}} = p_{\max}\left(\dfrac{\max(0, p_{\text{blue,global}} - f_g)}{1 - f_g}\right)^{\alpha_g}$ with defaults $p_{\max}=0.35$, floor $f_g=0.20$, exponent $\alpha_g=1.3$.</li>
                            <li><strong>Relative timing bonus:</strong> Being displaced later than the global median provides an advantage—you've watched peers navigate transitions and can learn from their paths. The bonus scales linearly with delay: $\text{bonus}_{\text{relative}} = b_{\max} \cdot \min\left(1, \dfrac{t_{\text{yours}} - t_{\text{global}}}{s_r}\right)$ where $b_{\max}=0.15$ and the scale $s_r=5.0$ years at defaults. Full bonus applies when displaced 5+ years after the global median.</li>
                        </ul>
                        <p>Seniority applies a small boost, and results clamp between 10% and 85%.</p>

                    </section>

                    <section>
                        <h2>Hierarchy levels and seniority effects</h2>

                        <p>Your position in the organizational hierarchy significantly affects both your automation timeline and compression vulnerability. The model defines five hierarchy levels, each with distinct parameter adjustments:</p>

                        <div class='bubble-table'>
                            <div class='bubble-item'><span class='bubble-key'>Level 1: Many layers above</span><span class='bubble-val'>Entry-level; highest compression risk</span></div>
                            <div class='bubble-item'><span class='bubble-key'>Level 2: Several layers above</span><span class='bubble-val'>Junior; moderate compression risk</span></div>
                            <div class='bubble-item'><span class='bubble-key'>Level 3: Few above or peers</span><span class='bubble-val'>Mid-level; baseline parameters</span></div>
                            <div class='bubble-item'><span class='bubble-key'>Level 4: Top of domain</span><span class='bubble-val'>Senior; reduced compression risk</span></div>
                            <div class='bubble-item'><span class='bubble-key'>Level 5: Unique/irreplaceable</span><span class='bubble-val'>Executive/owner; minimal compression risk</span></div>
                        </div>

                        <h3 class="h3-accent">Seniority profile adjustments</h3>

                        <p>Each hierarchy level applies four adjustments to the base model parameters:</p>

                        <ul class='detail-list'>
                            <li><strong>Theta lift ($\Delta\theta$):</strong> Adjusts the coverage threshold. Entry-level: -0.015 (automation triggers earlier); Level 5: +0.040 (requires higher AI capability before hazard activates). This reflects that senior roles typically require more comprehensive automation before replacement is viable.</li>
                            <li><strong>Hazard shield:</strong> Percentage reduction to base hazard rate. Ranges from 0% (Level 1) to 5% (Level 5). Senior roles have more organizational protection and replacement friction.</li>
                            <li><strong>Delay shift ($\Delta_{\text{seniority}}$):</strong> Adjusts implementation delay. Entry-level: -0.10 years (faster replacement); Level 5: +0.12 years (longer runway). Modified by job performance (Q19).</li>
                            <li><strong>Re-employment boost:</strong> Multiplier on re-employment probability. Ranges from 1.00&times; (Level 1) to 1.09&times; (Level 5). Senior experience improves job market prospects.</li>
                        </ul>

                        <h3 class="h3-accent">Task distribution shifts by seniority</h3>

                        <p>Hierarchy level also shifts your task duration profile. Entry-level roles skew toward shorter, more automatable tasks; senior roles skew toward longer, strategic tasks:</p>

                        <div class='parameter-table'>
                            <div class='table-label'>Seniority task weight shifts (added to base weights)</div>
                            <table>
                                <thead>
                                    <tr><th>Level</th><th>&lt;10m</th><th>10-45m</th><th>45m-3h</th><th>3-8h</th><th>&gt;12h</th></tr>
                                </thead>
                                <tbody>
                                    <tr><td>1 (Entry)</td><td>+12%</td><td>+8%</td><td>-5%</td><td>-8%</td><td>-7%</td></tr>
                                    <tr><td>2 (Junior)</td><td>+5%</td><td>+3%</td><td>-2%</td><td>-3%</td><td>-3%</td></tr>
                                    <tr><td>3 (Mid)</td><td>0%</td><td>0%</td><td>0%</td><td>0%</td><td>0%</td></tr>
                                    <tr><td>4 (Senior)</td><td>-6%</td><td>-4%</td><td>+3%</td><td>+4%</td><td>+3%</td></tr>
                                    <tr><td>5 (Exec)</td><td>-12%</td><td>-9%</td><td>+6%</td><td>+8%</td><td>+7%</td></tr>
                                </tbody>
                            </table>
                            <p style="font-size: 0.9em; margin-top: 12px; color: #666;">These shifts are applied to base weights before normalization. Entry-level concentrates work in short tasks; executive level shifts to longer strategic tasks.</p>
                        </div>

                        <p>The combined effect is substantial: an entry-level role faces earlier automation (lower theta), faster implementation (negative delay shift), higher compression vulnerability (100% hierarchy exposure), and a task profile weighted toward short, easily-automated tasks. A Level 5 executive faces the opposite on all dimensions.</p>
                    </section>

                    <section>
                        <h2>Worked Example: Mid-Level Data Analyst</h2>

                        <p>Taylor is a Level 2 data analyst at a 500-person SaaS company. Key questionnaire responses: Q1=4 (strong AI tools in domain), Q4=5 (fully digital), Q5=4 (decomposable), Q6=3 (mixed standardization), Q7=3 (moderate context), Q10=4 (easily reallocated).</p>

                        <div class="parameter-table">
                            <div class='table-label'>Calculation summary</div>
                            <table>
                                <tr><th>Step</th><th>Result</th></tr>
                                <tr><td>Task distribution</td><td>~60% in buckets 1-2 (short tasks), ~11% in buckets 4-5 (long tasks)</td></tr>
                                <tr><td>Domain friction</td><td>0.80× (high digital alignment, modest context)</td></tr>
                                <tr><td>Effective starting capability</td><td>~5.2 min (after 95% reliability penalty)</td></tr>
                                <tr><td>50% job readiness reached</td><td>~20 months (~1.7 years; automation hazard activates)</td></tr>
                                <tr><td>33% job readiness reached</td><td>~14 months (~1.2 years; compression hazard activates)</td></tr>
                                <tr><td>Hierarchy vulnerability</td><td>80% (Level 2 → $(6-2)/5$)</td></tr>
                                <tr><td>Compression readiness</td><td>~1.15 at 50% job readiness</td></tr>
                                <tr><td>Implementation delay</td><td>~1.7 years initial, decaying at ~0.018/year</td></tr>
                            </table>
                        </div>

                        <div class='insight-callout'>
                            <h4>Taylor's displacement forecast</h4>
                            <p><strong>Median timeline:</strong> ~3.1 years</p>
                            <p><strong>Risk breakdown:</strong> ~21% by year 2, ~47% by year 3, ~75% by ~4.3 years, ~84% by year 5</p>
                            <p><strong>Re-employment:</strong> Moderate (neutral adaptability with moderately decomposable work)</p>
                            <p><strong>Key insight:</strong> Compression dominates near-term risk because Level 2 hierarchy + high reallocation feasibility (Q10=4) activates at 33% readiness, earlier than the 50% automation threshold. The ~1.7-year implementation delay doesn't offset compression risk.</p>
                        </div>
                    </section>

                    <section>
                        <h2>Guide to Model Tuning</h2>
                        <p>The tuning panel exposes every parameter used in the hazard and compression calculations. Presets are grouped by the math they touch so you can mix capability, friction, compression, and rollout assumptions independently:</p>
                        <ul class='detail-list'>
                            <li><strong>Model Capability:</strong> Conservative / Baseline / Fast-Takeoff adjust only capability growth (METR doubling time and gate softness).</li>
                            <li><strong>Task Friction:</strong> Less / Baseline / More rescale domain and industry penalties that damp effective capability before it reaches the gates.</li>
                            <li><strong>Workforce Compression:</strong> Less / Baseline / More move the green-curve mechanics (reallocation weights, amplification, gate threshold, readiness floor).</li>
                            <li><strong>Adoption Guardrails:</strong> More drag / Baseline / Less drag tighten or loosen hazard caps/thresholds and implementation delay decay to explore deployment speed.</li>
                        </ul>
                        <p>These presets only set parameter values; you can override any field afterward. They do not change the underlying equations, only the assumed coefficients for capability, friction, compression, and rollout speed.</p>
                    </section>

                </div>
            </article>
        </div>
    </main>

    <script>
        // Build and highlight a subtle progress nav (desktop only)
        document.addEventListener('DOMContentLoaded', () => {
            // Wrap sections with header/body so structure is explicit for the nav
            const applySectionStructure = () => {
                const sections = document.querySelectorAll('.article-body > section');
                sections.forEach(sec => {
                    if (sec.querySelector('.section-body')) return;
                    const heading = sec.querySelector('h2, h3, h4');
                    if (!heading) return;
                    const headerEl = document.createElement('header');
                    headerEl.className = 'section-header';
                    sec.insertBefore(headerEl, heading);
                    headerEl.appendChild(heading);
                    const bodyEl = document.createElement('div');
                    bodyEl.className = 'section-body';
                    while (headerEl.nextSibling) {
                        bodyEl.appendChild(headerEl.nextSibling);
                    }
                    sec.appendChild(bodyEl);
                });
            };

            applySectionStructure();

            const list = document.getElementById('progress-list');
            const nav = document.querySelector('.progress-nav');
            if (!list) return;

            const headings = Array.from(document.querySelectorAll('main h2, main h3, article h2, article h3, .article-body h2, .article-body h3'))
                .filter(h => h.textContent.trim().length > 0);
            if (!headings.length) return;

            headings.forEach((h, idx) => {
                if (!h.id) {
                    h.id = `section-${idx + 1}`;
                }
                const li = document.createElement('li');
                const depth = h.tagName.toLowerCase() === 'h3' ? 'depth-3' : 'depth-2';
                li.classList.add(depth);
                const a = document.createElement('a');
                a.href = `#${h.id}`;
                a.textContent = h.textContent.trim();
                a.className = depth;
                li.appendChild(a);
                list.appendChild(li);
            });

            const links = Array.from(list.querySelectorAll('a'));
            const updateFill = (activeIdx) => {
                if (!nav || links.length <= 1) return;
                const pct = activeIdx <= 0 ? 0 : Math.round((activeIdx / (links.length - 1)) * 100);
                nav.style.setProperty('--progress-fill', `${pct}%`);
            };

            const setActive = (id) => {
                let activeIdx = 0;
                links.forEach((link, idx) => {
                    const isActive = link.getAttribute('href') === `#${id}`;
                    link.classList.toggle('active', isActive);
                    link.parentElement && link.parentElement.classList.toggle('active', isActive);
                    if (isActive) activeIdx = idx;
                });
                updateFill(activeIdx);
                const activeLi = links[activeIdx]?.parentElement;
                if (activeLi && nav) {
                    activeLi.scrollIntoView({ block: 'nearest', behavior: 'smooth' });
                }
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        setActive(entry.target.id);
                    }
                });
            }, {
                rootMargin: '-40% 0px -40% 0px',
                threshold: [0.1, 0.5, 1.0]
            });

            headings.forEach(h => observer.observe(h));
            setActive(headings[0].id);
        });
    </script>

    <script>
        const mathRoot = document.documentElement;
        const revealMath = () => {
            mathRoot.classList.remove('mathjax-pending', 'mathjax-rendering');
            mathRoot.classList.add('mathjax-ready');
            if (window.__mathjaxRevealTimeout) {
                clearTimeout(window.__mathjaxRevealTimeout);
                window.__mathjaxRevealTimeout = null;
            }
        };

        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            },
            svg: {
                fontCache: 'global'
            },
            startup: {
                pageReady: () => {
                    mathRoot.classList.remove('mathjax-pending');
                    mathRoot.classList.add('mathjax-rendering');
                    document.querySelectorAll('.equation-display').forEach(el => {
                        el.style.visibility = 'hidden';
                    });
                    return MathJax.startup.defaultPageReady().then(() => {
                        document.querySelectorAll('.equation-display').forEach(el => {
                            el.style.visibility = 'visible';
                        });
                        revealMath();
                    }).catch(err => {
                        console.error('MathJax typeset error', err);
                        revealMath();
                    });
                }
            }
        };
    </script>
    <script src='https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js' async></script>
    <script src='navigation.js'></script>
</body>

</html>
